import Foundation
import SwiftUI

extension String {
    /// æ ¹æ®å­—ç¬¦ä¸²å†…å®¹ç”Ÿæˆç›¸å…³çš„ emoji å¹¶æ·»åŠ åˆ°åŸå§‹å†…å®¹å‰
    /// - Returns: emoji + åŸå§‹å†…å®¹çš„ç»„åˆå­—ç¬¦ä¸²
    public var withContextEmoji: String {
        let emoji = self.generateContextEmoji()
        return "\(emoji) \(self)"
    }

    /// æ ¹æ®å­—ç¬¦ä¸²å†…å®¹åˆ†æå¹¶ç”Ÿæˆç›¸å…³çš„ emoji
    /// - Returns: ç›¸å…³çš„ emoji
    public func generateContextEmoji() -> String {
        let lowercased = self.lowercased()

        // å®šä¹‰ä¸€ä¸ªåŒ…å«æ‰€æœ‰åŒ¹é…çš„å…ƒç»„ï¼ŒæŒ‰ä¼˜å…ˆçº§æ’åº
        let emojiMappings: [(String, String)] = [
            ("archive", "ğŸ’¼"), ("å½’æ¡£", "ğŸ’¼"),
            ("appear", "ğŸ‘€"), ("å‡ºç°", "ğŸ‘€"),
            ("backup", "ğŸ’¼"), ("å¤‡ä»½", "ğŸ’¼"),
            ("bypass", "â­ï¸"), ("ç»•è¿‡", "â­ï¸"),
            ("click", "ğŸ‘†"), ("ç‚¹å‡»", "ğŸ‘†"),
            ("complete", "âœ…"), ("å®Œæˆ", "âœ…"),
            ("config", "ğŸš©"), ("é…ç½®", "ğŸš©"),
            ("crash", "âŒ"), ("å´©æºƒ", "âŒ"),
            ("data", "ğŸ’¾"), ("æ•°æ®", "ğŸ’¾"),
            ("debug", "ğŸ”"), ("è°ƒè¯•", "ğŸ”"),
            ("display", "ğŸ‘€"), ("å±•ç¤º", "ğŸ‘€"),
            ("done", "âœ…"), ("å®Œæˆ", "âœ…"),
            ("error", "âŒ"), ("é”™è¯¯", "âŒ"),
            ("fail", "âŒ"), ("å¤±è´¥", "âŒ"),
            ("finish", "âœ…"), ("ç»“æŸ", "âœ…"),
            ("http", "ğŸŒ"), ("HTTP", "ğŸŒ"),
            ("ignore", "â­ï¸"), ("å¿½ç•¥", "â­ï¸"),
            ("init", "ğŸš©"), ("åˆå§‹åŒ–", "ğŸš©"),
            ("load", "ğŸ’¾"), ("åŠ è½½", "ğŸ’¾"),
            ("manager", "ğŸ‘”"), ("ç»ç†", "ğŸ‘”"),
            ("merge", "ğŸ”—"), ("åˆå¹¶", "ğŸ”—"),
            ("memory", "ğŸ“Š"), ("å†…å­˜", "ğŸ“Š"),
            ("modify", "ğŸ‹"), ("ä¿®æ”¹", "ğŸ‹"),
            ("network", "ğŸŒ"), ("ç½‘ç»œ", "ğŸŒ"),
            ("notification", "ğŸ””"), ("é€šçŸ¥", "ğŸ””"),
            ("ok", "âœ…"), ("å¥½çš„", "âœ…"),
            ("performance", "ğŸ“Š"), ("æ€§èƒ½", "ğŸ“Š"),
            ("plugin", "ğŸ”Œ"), ("æ’ä»¶", "ğŸ”Œ"),
            ("push", "â¬†ï¸"), ("æ¨é€", "â¬†ï¸"),
            ("ready", "âœ…"), ("å‡†å¤‡å¥½", "âœ…"),
            ("save", "ğŸ’¾"), ("ä¿å­˜", "ğŸ’¾"),
            ("set", "âš™ï¸"), ("è®¾ç½®", "âš™ï¸"),
            ("show", "ğŸ‘€"), ("æ˜¾ç¤º", "ğŸ‘€"),
            ("skip", "â­ï¸"), ("è·³è¿‡", "â­ï¸"),
            ("synchronize", "ğŸ”„"), ("åŒæ­¥", "ğŸ”„"),
            ("tap", "ğŸ‘†"), ("è½»è§¦", "ğŸ‘†"),
            ("test", "ğŸ”"), ("æµ‹è¯•", "ğŸ”"),
            ("update", "ğŸ‹"), ("æ›´æ–°", "ğŸ‹"),
            ("uuid", "ğŸ†”"), ("å”¯ä¸€æ ‡è¯†ç¬¦", "ğŸ†”"),
            ("visible", "ğŸ‘€"), ("å¯è§", "ğŸ‘€"),
            ("warn", "âš ï¸"), ("è­¦å‘Š", "âš ï¸"),
            ("warning", "âš ï¸"), ("è­¦å‘Š", "âš ï¸"),
        ]

        // éå†æ‰€æœ‰æ˜ å°„ï¼Œä¼˜å…ˆè¿”å›åŒ¹é…çš„ emoji
        for (keyword, emoji) in emojiMappings {
            if lowercased.hasPrefix(keyword) || lowercased.contains(keyword) {
                return emoji
            }
        }

        // é»˜è®¤è¿”å›ä¸€ä¸ªé€šç”¨çš„ emoji
        return "ğŸ“"
    }
}

struct StringEmojiPreview: View {
    let examples = [
        // é”™è¯¯å’Œè­¦å‘Š
        "ç½‘ç»œè¯·æ±‚å¤±è´¥äº†",
        "è­¦å‘Šï¼šå†…å­˜ä½¿ç”¨è¿‡é«˜",

        // æˆåŠŸå’Œå®Œæˆ
        "æ•°æ®ä¿å­˜æˆåŠŸ",
        "ä»»åŠ¡å®Œæˆ",

        // ç½‘ç»œç›¸å…³
        "å‘èµ·ç½‘ç»œè¯·æ±‚",
        "HTTPå“åº”è¶…æ—¶",

        // æ•°æ®ç›¸å…³
        "æ­£åœ¨åŠ è½½æ•°æ®",
        "å¼€å§‹ä¿å­˜æ–‡ä»¶",

        // åˆå§‹åŒ–å’Œé…ç½®
        "åˆå§‹åŒ–ç³»ç»Ÿé…ç½®",
        "è®¾ç½®ç”¨æˆ·å‚æ•°",

        // æ›´æ–°å’Œå˜åŒ–
        "æ›´æ–°ç”¨æˆ·ä¿¡æ¯",
        "ä¿®æ”¹é…ç½®æ–‡ä»¶",

        // è°ƒè¯•å’Œæµ‹è¯•
        "è°ƒè¯•æ¨¡å¼å¯åŠ¨",
        "å¼€å§‹æ€§èƒ½æµ‹è¯•",

        // æ€§èƒ½ç›¸å…³
        "CPUä½¿ç”¨ç‡è¿‡é«˜",
        "æ£€æµ‹å†…å­˜æ³„æ¼",

        // ç”¨æˆ·äº¤äº’
        "ç”¨æˆ·ç‚¹å‡»ç™»å½•æŒ‰é’®",
        "æ£€æµ‹åˆ°åŒæŒ‡æ‰‹åŠ¿",

        // è·³è¿‡ç›¸å…³
        "è·³è¿‡æ­¤æ­¥éª¤",
        "å¿½ç•¥é”™è¯¯ç»§ç»­",
    ]

    var body: some View {
        VStack(alignment: .leading, spacing: 4) {
            ForEach(examples, id: \.self) { text in
                Text("åŸå§‹æ–‡æœ¬ï¼š\(text)")
                    .font(.subheadline)
                    .foregroundColor(.gray)
                Text("æ·»åŠ  Emojiï¼š\(text.withContextEmoji)")
                    .font(.body)
            }
            .padding(.vertical, 4)
        }
    }
}

#if DEBUG
    #Preview {
        StringEmojiPreview()
    }
#endif
